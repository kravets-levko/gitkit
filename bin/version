#!/usr/bin/env bash

PROJECT_ROOT=$(dirname $(dirname $(realpath $0)));

(
  git tag --list --contains HEAD --sort=-refname:short --format="%(refname:short)";
  # if no tags containing HEAD - list all tags (most likely HEAD is above all
  # existing tags)
  git tag --list --sort=-refname:short --format="%(refname:short)";
  # fallback - if no tags at all
  echo "v0.0.0";
) | head -n 1 > ${PROJECT_ROOT}/VERSION;

cat ${PROJECT_ROOT}/VERSION;
